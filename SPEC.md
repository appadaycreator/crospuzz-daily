# CrosPuzz 仕様書

## 📋 プロジェクト概要

### プロジェクト名
CrosPuzz - 毎日のクロスワードパズル

### バージョン
1.0.5

### 作成日
2024年1月15日

### 最終更新日
2024年7月24日

### 作成者
AppAdayCreator

## 🎯 プロジェクト目標

### 主な目標
1. **脳トレ効果**: 認知症予防・脳活性化
2. **ユーザビリティ**: 直感的で使いやすいインターフェース
3. **アクセシビリティ**: 誰でも利用可能なデザイン
4. **パフォーマンス**: 高速で軽量なアプリケーション
5. **PWA対応**: ネイティブアプリのような体験

### ターゲットユーザー
- **年齢層**: 20代〜70代
- **用途**: 脳トレ・暇つぶし・学習
- **デバイス**: スマートフォン・タブレット・PC

## 🏗️ アーキテクチャ

### 技術スタック
```
フロントエンド
├── HTML5 (セマンティックマークアップ)
├── CSS3 (Tailwind CSS + カスタム)
├── JavaScript (ES6+)
└── PWA (Service Worker, Manifest)

ライブラリ
├── Tailwind CSS 2.2.19
├── Font Awesome 6.4.0
└── Google Fonts (Noto Sans JP, Inter)
```

### ファイル構造
```
crospuzz-daily/
├── index.html              # メインエントリーポイント
├── assets/
│   ├── css/
│   │   └── styles.css      # カスタムスタイル
│   ├── js/
│   │   └── app.js          # メインロジック
│   └── images/             # 画像リソース
├── static/
│   └── puzzles/
│       └── daily-puzzle.json # パズルデータ
├── tests/
│   └── test-app.js         # テストスイート
├── docs/                   # ドキュメント
├── sw.js                   # Service Worker
└── 設定ファイル
```

## 🎮 機能仕様

### 1. ゲーム機能

#### 1.1 クロスワードパズル
- **グリッドサイズ**: 10×10〜15×15マス（動的調整）
- **難易度**: 初級・中級・上級
- **言語対応**: 日本語・英語
- **入力方式**: キーボード・タッチ
- **🆕 改良点**: タテとヨコのカギがバランスよく生成される最適化アルゴリズム
- **🆕 パフォーマンス**: 単語数制限（最大8個）による処理速度向上
- **🆕 安定性**: タイムアウト機能とフォールバック機能で確実なパズル生成

#### 1.2 進捗管理
- **リアルタイム更新**: 入力済みマスの表示
- **パーセンテージ表示**: 完了率の計算
- **セルカウント**: 入力済み/総マス数

#### 1.3 タイマー機能
- **経過時間**: 分:秒形式
- **自動開始**: ゲーム開始時
- **一時停止**: ページ離脱時
- **完了記録**: 最終時間の保存

#### 1.4 ヒントシステム
- **使用回数**: 3回まで
- **ヒント内容**: ランダム選択
- **残り表示**: 残り回数の表示
- **制限機能**: 0回時の無効化

#### 1.5 初期化機能
- **初期化ボタン**: ゲーム状態・設定・ローカルストレージを完全初期化
- **リセットボタン**: 入力内容のみをクリア

### 2. UI/UX機能

#### 2.1 レスポンシブデザイン
```
ブレークポイント
├── モバイル: < 768px
├── タブレット: 768px - 1024px
└── デスクトップ: > 1024px
```

#### 2.2 ダークモード
- **自動検出**: システム設定の反映
- **手動切り替え**: ユーザー設定
- **永続化**: ローカルストレージ保存
- **スムーズ切り替え**: トランジション効果

#### 2.3 多言語対応
```javascript
対応言語
├── 日本語 (ja)
└── 英語 (en)

翻訳キー
├── ナビゲーション (nav_*)
├── ゲーム要素 (game_*)
├── 設定項目 (settings_*)
└── メッセージ (message_*)
```

#### 2.4 フォントサイズ調整
```
サイズ設定
├── 極小 (xs): 0.75rem
├── 小 (sm): 0.875rem
├── 標準 (base): 1rem
├── 大 (lg): 1.125rem
└── 特大 (xl): 1.25rem
```

### 3. PWA機能

#### 3.1 Service Worker
- **キャッシュ戦略**: Network First
- **オフライン対応**: 基本機能の継続
- **バックグラウンド同期**: データ同期
- **プッシュ通知**: 新パズル通知

#### 3.2 Manifest
```json
{
  "name": "CrosPuzz - 毎日のクロスワードパズル",
  "short_name": "CrosPuzz",
  "start_url": "./",
  "display": "standalone",
  "theme_color": "#4F46E5",
  "background_color": "#ffffff"
}
```

#### 3.3 インストール機能
- **自動検出**: インストール条件の確認
- **手動インストール**: ユーザー操作
- **ホーム画面追加**: ネイティブアプリ体験

### 4. データ管理

#### 4.1 ローカルストレージ
```javascript
保存データ
├── crospuzz_settings
│   ├── language: 言語設定
│   ├── fontSize: フォントサイズ
│   └── darkMode: ダークモード設定
└── crospuzz_game_state
    ├── userAnswers: ユーザー入力
    ├── startTime: 開始時間
    └── hintsRemaining: 残りヒント数
```

#### 4.2 パズルデータ構造
```json
{
  "id": "2024-01-15",
  "date": "2024-01-15",
  "difficulty": "beginner",
  "size": "7x7",
  "grid": [[...]],
  "blocked": [[...]],
  "answers": {...},
  "clues": {
    "across": {...},
    "down": {...}
  },
  "metadata": {...}
}
```

## ♿ アクセシビリティ仕様

### WCAG 2.1 AA準拠

#### 1. キーボードナビゲーション
- **Tab順序**: 論理的な移動順序
- **フォーカス表示**: 明確な視覚的フィードバック
- **ショートカット**: 効率的な操作

#### 2. スクリーンリーダー対応
- **ARIA属性**: 適切なラベル付け
- **セマンティックHTML**: 意味のある構造
- **代替テキスト**: 画像の説明

#### 3. 視覚的アクセシビリティ
- **コントラスト比**: 4.5:1以上
- **フォントサイズ**: 最小16px
- **色覚異常対応**: 色以外の情報提供

#### 4. 動作アクセシビリティ
- **アニメーション制御**: ユーザー設定の尊重
- **タイミング制御**: 十分な操作時間
- **エラー処理**: 明確なエラーメッセージ

## 📊 パフォーマンス仕様

### Core Web Vitals目標

#### 1. Largest Contentful Paint (LCP)
- **目標**: < 2.5秒
- **測定**: 最大コンテンツの表示時間
- **最適化**: 画像最適化、CDN利用

#### 2. First Input Delay (FID)
- **目標**: < 100ms
- **測定**: 初回入力の応答時間
- **最適化**: JavaScript最適化

#### 3. Cumulative Layout Shift (CLS)
- **目標**: < 0.1
- **測定**: レイアウトの安定性
- **最適化**: 適切なサイズ指定

### 最適化戦略

#### 1. リソース最適化
- **画像圧縮**: WebP形式の使用
- **CSS/JS圧縮**: ファイルサイズ最小化
- **遅延読み込み**: 必要時読み込み

#### 2. キャッシュ戦略
- **ブラウザキャッシュ**: 静的リソース
- **Service Worker**: 動的コンテンツ
- **CDN利用**: 地理的分散

#### 3. コード最適化
- **Tree Shaking**: 未使用コード削除
- **Minification**: コード圧縮
- **Bundle分割**: 効率的な分割

## 🧪 テスト仕様

### テストカバレッジ

#### 1. ユニットテスト
```javascript
テスト対象
├── ゲーム初期化
├── パズルデータ構造
├── 翻訳機能
├── 設定管理
├── 進捗計算
├── タイマー機能
├── ヒントシステム
├── 言語切り替え
├── ダークモード切り替え
├── フォントサイズ機能
├── モバイルメニュー
└── ゲーム状態管理
```

#### 2. 統合テスト
- **ブラウザ互換性**: Chrome, Firefox, Safari, Edge
- **デバイス対応**: スマートフォン, タブレット, PC
- **PWA機能**: インストール, オフライン動作

#### 3. アクセシビリティテスト
- **キーボードナビゲーション**: 全機能の操作
- **スクリーンリーダー**: NVDA, JAWS対応
- **コントラスト比**: 色覚異常シミュレーション

## 🔒 セキュリティ仕様

### 1. データ保護
- **ローカルストレージ**: クライアントサイドのみ
- **HTTPS通信**: 全通信の暗号化
- **CSP設定**: コンテンツセキュリティポリシー

### 2. プライバシー
- **データ収集最小化**: 必要最小限の情報
- **ユーザー同意**: 明確な同意取得
- **データ削除**: 簡単な削除機能

### 3. 脆弱性対策
- **XSS対策**: 入力値の適切な処理
- **CSRF対策**: トークンによる保護
- **クリックジャッキング対策**: X-Frame-Options

## 📈 分析・監視仕様

### 1. Google Analytics
```javascript
追跡イベント
├── ページビュー
├── ゲーム開始
├── パズル完了
├── ヒント使用
├── 設定変更
└── エラー発生
```

### 2. パフォーマンス監視
- **Real User Monitoring**: 実際のユーザー体験
- **エラー追跡**: 自動エラー検出
- **パフォーマンス指標**: Core Web Vitals

### 3. ユーザー行動分析
- **ヒートマップ**: クリック・スクロール分析
- **コンバージョン追跡**: 目標達成率
- **A/Bテスト**: 機能改善の検証

## 🚀 デプロイメント仕様

### 1. 環境設定
```
環境
├── 開発環境 (Development)
├── ステージング環境 (Staging)
└── 本番環境 (Production)
```

### 2. CI/CDパイプライン
```yaml
ステップ
├── コード品質チェック (ESLint, Prettier)
├── テスト実行 (Jest)
├── ビルド処理 (Webpack)
├── デプロイ (GitHub Pages)
└── 監視設定 (Analytics)
```

### 3. リリース戦略
- **セマンティックバージョニング**: 1.0.0
- **変更ログ**: 詳細な更新履歴
- **ロールバック**: 緊急時の復旧手順

## 📋 今後の拡張計画

### 1. 短期目標 (1-3ヶ月)
- **追加難易度**: 中級・上級パズル
- **統計機能**: 個人成績の記録
- **ソーシャル機能**: 結果のシェア

### 2. 中期目標 (3-6ヶ月)
- **AI生成パズル**: 自動パズル作成
- **マルチプレイヤー**: 対戦機能
- **アチーブメント**: 達成システム

### 3. 長期目標 (6ヶ月以上)
- **モバイルアプリ**: ネイティブアプリ版
- **音声対応**: 音声入力・読み上げ
- **AR機能**: 拡張現実での体験

## 📞 サポート・保守

### 1. バグ報告
- **GitHub Issues**: 詳細な報告フォーム
- **再現手順**: 明確な手順書
- **環境情報**: ブラウザ・OS情報

### 2. 機能要望
- **優先度設定**: 重要度の評価
- **実装計画**: ロードマップ
- **フィードバック**: ユーザー投票

### 3. ドキュメント
- **API仕様**: 開発者向け
- **ユーザーガイド**: 一般ユーザー向け
- **トラブルシューティング**: よくある問題

## ⚠️ 既知の問題

### Service Workerキャッシュ問題
Web版で古いパズルデータがキャッシュされ、新しい上級問題が表示されない場合があります。

**原因：**
- Service Workerによる積極的なキャッシュ
- puzzles.jsonファイルの更新が反映されない

**対策：**
- v1.0.6でService Workerを改善（puzzles.jsonは常に最新版を取得）
- キャッシュバージョンを更新してクリア促進
- ユーザーへの手動キャッシュクリア方法の案内

## 📝 変更履歴

### v1.0.5 (2024/07/24) - 難易度別選択機能実装
#### 🎮 直感的UI設計
- 3つの難易度ボタンによるワンクリック選択
- アイコン付きボタンで視覚的に分かりやすいデザイン
- 選択状態の明確な表示とスムーズなホバーエフェクト

#### 🎨 視覚的フィードバック強化
- 選択中の難易度ボタンの色彩変化
- 難易度別カラーテーマ（緑:初級、黄:中級、赤:上級）
- アニメーション付きの状態遷移

#### 💾 状態管理機能
- 選択した難易度の自動保存機能
- 次回起動時の難易度復元機能
- ローカルストレージとの連携

#### 🏷️ 動的バッジシステム
- アイコン付き難易度表示の自動更新
- 難易度変更に応じたバッジの色・アイコン変更
- リアルタイムな視覚フィードバック

#### 📋 フィルタ機能
- 選択した難易度のパズルのみを表示
- 不要な選択肢を隠すことでユーザビリティ向上
- シームレスな難易度切り替え

### v1.0.4 (2024/07/24) - 難易度別問題大幅拡充
#### 🎯 問題数拡充
- 各難易度に5問ずつ、合計15問の豊富なパズルを追加
- 初級から上級まで幅広いテーマを網羅
- パズル選択の自由度が大幅に向上

#### 🟢 初級パズル（5問）
- 動物の名前（ねこ、いぬ、うさぎ、等）
- 果物の名前（りんご、みかん、ばなな、等）
- 乗り物の名前（くるま、でんしゃ、ひこうき、等）
- 色の名前（あか、あお、きいろ、等）
- 身の回りのもの（つくえ、いす、かばん、等）

#### 🟡 中級パズル（5問）
- 日本の食べ物（らーめん、すし、てんぷら、等）
- スポーツ競技（やきゅう、さっかー、すもう、等）
- 日本の都道府県（とうきょう、おおさか、ほっかいどう、等）
- 四季と自然（はる、なつ、あき、ふゆ、等）
- 職業の名前（せんせい、いしゃ、けいさつ、等）

#### 🔴 上級パズル（5問）
- 科学技術用語（でんし、げんし、ぶんし、等）
- 医学・身体（しんぞう、はい、かんじん、等）
- 地理・世界（あじあ、よーろっぱ、あふりか、等）
- 芸術・文化（おんがく、かいが、ちょうこく、等）
- 歴史・時代（へいあん、かまくら、むろまち、等）

#### 🎮 パズル選択機能
- ドロップダウンメニューで自由に選択可能
- 難易度別にグループ化された分かりやすいUI
- 視覚的に分かりやすい難易度バッジ表示

### v1.0.3 (2024/07/24) - 番号付けロジック修正
#### 🔢 番号付けロジック改善
- 実際に配置された単語のみに番号を付与するように修正
- パズル番号とカギ番号の不一致問題を根本解決
- Z-order（左上から右下へ）による正確な番号付け

#### 📋 カギと番号の完全一致
- グリッド番号とカギ番号を100%整合
- 「パズル上は番号があるのにカギに該当番号がない」問題を完全解決
- 番号付けアルゴリズムの完全書き直し

#### 📊 デバッグ機能追加
- 番号付けプロセスの詳細ログを追加
- 単語配置と番号付けの追跡機能
- 品質保証のための検証機能

#### ✅ 品質保証
- 番号とカギの不一致問題を完全に解決
- パズル生成品質の大幅向上
- ユーザー体験の改善

### v1.0.2 (2024/07/24) - 緊急パッチ
#### 🚨 緊急修正
- パズルが表示されない致命的な無限ループ問題を解決
- ユーザーが空白画面しか見えない重大な不具合を修正

#### ⚡ パフォーマンス改善
- 単語数を8個に制限し、処理速度を大幅向上
- タイムアウト機能（5秒）でブラウザフリーズを防止
- グリッドサイズを7×7〜11×11マスに最適化

#### 🛡️ 安定性改善
- シンプルフォールバック関数を実装
- 最小限のパズルチェック機能を追加
- フェイルセーフ機能で確実なパズル生成を保証

#### 📊 デバッグ強化
- 詳細なログでトラブルシューティングを改善
- エラーハンドリングの強化

### v1.0.1 (2024/07/24)
#### 🐛 バグ修正
- タテの鍵が表示されない問題を解決
- パズル生成時の番号付けロジックを改善

#### ⚡ パフォーマンス改善
- 単語数制限（最大15個）による処理速度向上
- 無限ループ防止のための再試行回数制限（最大3回）
- グリッドサイズの動的調整（10×10〜15×15マス）

#### 🔧 改良
- デバッグログの充実
- エラーハンドリングの強化
- パズル生成アルゴリズムの最適化

#### 📁 その他
- .gitignoreファイルの追加
- function.htmlページの作成
- ドキュメント更新

### v1.0.0 (2024/01/15)
- 初回リリース
- 基本的なクロスワードパズル機能
- PWA対応
- 多言語対応（日本語・英語）
- アクセシビリティ対応

---

**CrosPuzz 仕様書 v1.0.5**

*最終更新: 2024年7月24日* 