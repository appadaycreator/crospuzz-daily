<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パズル選択テスト</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        select { margin: 10px; padding: 5px; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>パズル選択機能テスト</h1>
    
    <div>
        <h2>難易度選択ボタン</h2>
        <!-- 難易度選択 -->
        <div>
            <button id="difficultyBeginner" onclick="selectDifficulty('beginner')" style="background-color: #10B981; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
                🌱 初級
            </button>
            <button id="difficultyIntermediate" onclick="selectDifficulty('intermediate')" style="background-color: #F59E0B; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
                ⚡ 中級
            </button>
            <button id="difficultyAdvanced" onclick="selectDifficulty('advanced')" style="background-color: #EF4444; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
                🏆 上級
            </button>
        </div>
    </div>
    
    <div>
        <h2>パズル選択</h2>
        <select id="puzzleSelect" style="width: 300px; padding: 5px;">
            <!-- オプションはJavaScriptで生成 -->
        </select>
    </div>
    
    <div>
        <h2>現在の状態</h2>
        <div id="status">読み込み中...</div>
    </div>
    
    <div>
        <h2>テスト結果</h2>
        <div id="testResults"></div>
    </div>

    <script>
        // パズルデータ（テスト用）
        let puzzles = {};
        let currentSelectedDifficulty = 'beginner';
        
        // JSONファイルからパズルデータを読み込む
        async function loadPuzzleData() {
            try {
                const response = await fetch('/static/puzzles/puzzles.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                puzzles = await response.json();
                updateStatus(`パズルデータ読み込み完了: ${Object.keys(puzzles).map(d => `${d}: ${puzzles[d].length}個`).join(', ')}`);
                
                // 初期化
                selectDifficulty('beginner');
                runTests();
            } catch (error) {
                updateStatus(`パズルデータの読み込みに失敗: ${error.message}`);
            }
        }
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = `<p>${new Date().toLocaleTimeString()}: ${message}</p>` + document.getElementById('status').innerHTML;
            console.log(message);
        }
        
        function selectDifficulty(difficulty) {
            currentSelectedDifficulty = difficulty;
            updateStatus(`難易度選択: ${difficulty}`);
            
            // パズル選択リストを更新
            updatePuzzleSelect(difficulty);
            
            // ボタンの状態を更新
            updateDifficultyButtons(difficulty);
        }
        
        function updatePuzzleSelect(difficulty) {
            const select = document.getElementById('puzzleSelect');
            if (!select) {
                updateStatus('ERROR: puzzleSelectエレメントが見つかりません');
                return;
            }
            
            select.innerHTML = '';
            
            if (puzzles[difficulty]) {
                updateStatus(`${difficulty}の問題数: ${puzzles[difficulty].length}`);
                puzzles[difficulty].forEach((puzzle, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = puzzle.title;
                    select.appendChild(option);
                    updateStatus(`オプション追加: index=${index}, title=${puzzle.title}`);
                });
            } else {
                updateStatus(`ERROR: ${difficulty}の問題データが見つかりません`);
            }
            
            // 選択イベントリスナーを設定
            select.onchange = function(e) {
                const index = parseInt(e.target.value);
                const selectedPuzzle = puzzles[currentSelectedDifficulty][index];
                updateStatus(`パズル選択変更: difficulty=${currentSelectedDifficulty}, index=${index}, title=${selectedPuzzle.title}`);
            };
            
            updateStatus(`updatePuzzleSelect完了: 現在のオプション数=${select.options.length}`);
        }
        
        function updateDifficultyButtons(selectedDifficulty) {
            const buttons = ['difficultyBeginner', 'difficultyIntermediate', 'difficultyAdvanced'];
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    if (buttonId.includes(selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1))) {
                        button.style.opacity = '1';
                        button.style.transform = 'scale(1.05)';
                    } else {
                        button.style.opacity = '0.7';
                        button.style.transform = 'scale(1)';
                    }
                }
            });
        }
        
        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h3>テスト実行中...</h3>';
            
            // テスト1: 初級パズルの確認
            testDifficulty('beginner', results);
            
            // テスト2: 中級パズルの確認
            testDifficulty('intermediate', results);
            
            // テスト3: 上級パズルの確認
            testDifficulty('advanced', results);
        }
        
        function testDifficulty(difficulty, resultsContainer) {
            selectDifficulty(difficulty);
            
            setTimeout(() => {
                const select = document.getElementById('puzzleSelect');
                const testResult = document.createElement('div');
                testResult.className = 'test-result';
                
                if (select.options.length > 0) {
                    testResult.className += ' success';
                    testResult.innerHTML = `
                        <h4>${difficulty}テスト: 成功 ✅</h4>
                        <p>オプション数: ${select.options.length}</p>
                        <p>パズル一覧:</p>
                        <ul>${Array.from(select.options).map(opt => `<li>index=${opt.value}: ${opt.textContent}</li>`).join('')}</ul>
                    `;
                } else {
                    testResult.className += ' error';
                    testResult.innerHTML = `
                        <h4>${difficulty}テスト: 失敗 ❌</h4>
                        <p>オプションが生成されませんでした</p>
                    `;
                }
                
                resultsContainer.appendChild(testResult);
            }, 100);
        }
        
        // ページ読み込み時にテスト開始
        document.addEventListener('DOMContentLoaded', loadPuzzleData);
    </script>
</body>
</html>