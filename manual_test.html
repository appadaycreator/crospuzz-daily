<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ã‚ºãƒ«é¸æŠãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { padding: 10px; margin: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        select { margin: 10px; padding: 5px; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>ãƒ‘ã‚ºãƒ«é¸æŠæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div>
        <h2>é›£æ˜“åº¦é¸æŠãƒœã‚¿ãƒ³</h2>
        <!-- é›£æ˜“åº¦é¸æŠ -->
        <div>
            <button id="difficultyBeginner" onclick="selectDifficulty('beginner')" style="background-color: #10B981; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
                ğŸŒ± åˆç´š
            </button>
            <button id="difficultyIntermediate" onclick="selectDifficulty('intermediate')" style="background-color: #F59E0B; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
                âš¡ ä¸­ç´š
            </button>
            <button id="difficultyAdvanced" onclick="selectDifficulty('advanced')" style="background-color: #EF4444; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px;">
                ğŸ† ä¸Šç´š
            </button>
        </div>
    </div>
    
    <div>
        <h2>ãƒ‘ã‚ºãƒ«é¸æŠ</h2>
        <select id="puzzleSelect" style="width: 300px; padding: 5px;">
            <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JavaScriptã§ç”Ÿæˆ -->
        </select>
    </div>
    
    <div>
        <h2>ç¾åœ¨ã®çŠ¶æ…‹</h2>
        <div id="status">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>
    
    <div>
        <h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="testResults"></div>
    </div>

    <script>
        // ãƒ‘ã‚ºãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        let puzzles = {};
        let currentSelectedDifficulty = 'beginner';
        
        // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‘ã‚ºãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        async function loadPuzzleData() {
            try {
                const response = await fetch('/static/puzzles/puzzles.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                puzzles = await response.json();
                updateStatus(`ãƒ‘ã‚ºãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: ${Object.keys(puzzles).map(d => `${d}: ${puzzles[d].length}å€‹`).join(', ')}`);
                
                // åˆæœŸåŒ–
                selectDifficulty('beginner');
                runTests();
            } catch (error) {
                updateStatus(`ãƒ‘ã‚ºãƒ«ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`);
            }
        }
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = `<p>${new Date().toLocaleTimeString()}: ${message}</p>` + document.getElementById('status').innerHTML;
            console.log(message);
        }
        
        function selectDifficulty(difficulty) {
            currentSelectedDifficulty = difficulty;
            updateStatus(`é›£æ˜“åº¦é¸æŠ: ${difficulty}`);
            
            // ãƒ‘ã‚ºãƒ«é¸æŠãƒªã‚¹ãƒˆã‚’æ›´æ–°
            updatePuzzleSelect(difficulty);
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            updateDifficultyButtons(difficulty);
        }
        
        function updatePuzzleSelect(difficulty) {
            const select = document.getElementById('puzzleSelect');
            if (!select) {
                updateStatus('ERROR: puzzleSelectã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            select.innerHTML = '';
            
            if (puzzles[difficulty]) {
                updateStatus(`${difficulty}ã®å•é¡Œæ•°: ${puzzles[difficulty].length}`);
                puzzles[difficulty].forEach((puzzle, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = puzzle.title;
                    select.appendChild(option);
                    updateStatus(`ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ : index=${index}, title=${puzzle.title}`);
                });
            } else {
                updateStatus(`ERROR: ${difficulty}ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
            }
            
            // é¸æŠã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            select.onchange = function(e) {
                const index = parseInt(e.target.value);
                const selectedPuzzle = puzzles[currentSelectedDifficulty][index];
                updateStatus(`ãƒ‘ã‚ºãƒ«é¸æŠå¤‰æ›´: difficulty=${currentSelectedDifficulty}, index=${index}, title=${selectedPuzzle.title}`);
            };
            
            updateStatus(`updatePuzzleSelectå®Œäº†: ç¾åœ¨ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ•°=${select.options.length}`);
        }
        
        function updateDifficultyButtons(selectedDifficulty) {
            const buttons = ['difficultyBeginner', 'difficultyIntermediate', 'difficultyAdvanced'];
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    if (buttonId.includes(selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1))) {
                        button.style.opacity = '1';
                        button.style.transform = 'scale(1.05)';
                    } else {
                        button.style.opacity = '0.7';
                        button.style.transform = 'scale(1)';
                    }
                }
            });
        }
        
        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h3>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h3>';
            
            // ãƒ†ã‚¹ãƒˆ1: åˆç´šãƒ‘ã‚ºãƒ«ã®ç¢ºèª
            testDifficulty('beginner', results);
            
            // ãƒ†ã‚¹ãƒˆ2: ä¸­ç´šãƒ‘ã‚ºãƒ«ã®ç¢ºèª
            testDifficulty('intermediate', results);
            
            // ãƒ†ã‚¹ãƒˆ3: ä¸Šç´šãƒ‘ã‚ºãƒ«ã®ç¢ºèª
            testDifficulty('advanced', results);
        }
        
        function testDifficulty(difficulty, resultsContainer) {
            selectDifficulty(difficulty);
            
            setTimeout(() => {
                const select = document.getElementById('puzzleSelect');
                const testResult = document.createElement('div');
                testResult.className = 'test-result';
                
                if (select.options.length > 0) {
                    testResult.className += ' success';
                    testResult.innerHTML = `
                        <h4>${difficulty}ãƒ†ã‚¹ãƒˆ: æˆåŠŸ âœ…</h4>
                        <p>ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ•°: ${select.options.length}</p>
                        <p>ãƒ‘ã‚ºãƒ«ä¸€è¦§:</p>
                        <ul>${Array.from(select.options).map(opt => `<li>index=${opt.value}: ${opt.textContent}</li>`).join('')}</ul>
                    `;
                } else {
                    testResult.className += ' error';
                    testResult.innerHTML = `
                        <h4>${difficulty}ãƒ†ã‚¹ãƒˆ: å¤±æ•— âŒ</h4>
                        <p>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</p>
                    `;
                }
                
                resultsContainer.appendChild(testResult);
            }, 100);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ†ã‚¹ãƒˆé–‹å§‹
        document.addEventListener('DOMContentLoaded', loadPuzzleData);
    </script>
</body>
</html>