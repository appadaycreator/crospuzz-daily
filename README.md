# CrosPuzz - 毎日のクロスワードパズル

[![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)](https://github.com/appadaycreator/crospuzz-daily)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![PWA](https://img.shields.io/badge/PWA-Ready-orange.svg)](https://web.dev/progressive-web-apps/)
[![Accessibility](https://img.shields.io/badge/Accessibility-WCAG%202.1%20AA-brightgreen.svg)](https://www.w3.org/WAI/WCAG21/AA/)

## 📖 概要

CrosPuzzは、毎日更新される脳トレクロスワードパズルのWebアプリケーションです。日本語・英語対応で、初級から上級まで難易度選択が可能です。

### 🎯 クロスワードビルダー.com準拠ルール対応

- **盤面とマス**: 正方形グリッド（9×9〜15×15可変）、白マスに文字、黒マス（■）で単語の区切り
- **番号付け**: 「Z」の順（左上から右下へ）に数字を振り当て、語頭マスに昇順番号付与
- **単語の入力方向**: ヨコ（左→右）、タテ（上→下）、交差点で文字一致
- **回答形式**: かな表記で統一（小さな文字は大きな文字に統一）
- **ヒント**: 番号＋方向（例：1-ヨコ、1-タテ）と手がかり文
- **完成条件**: すべての白マスが正しい文字で埋まり、すべての単語がヒントと一致
- **制約**: 
  - 黒マスをタテやヨコに連続させない
  - 黒マスでマス目を分断させない
  - 黒マスを四隅に配置しない
  - 180度回転対称性（ニコリ社ルール）
- **言葉ルール**: 
  - 小さな「ヤユヨ・ツ・アイウエオ」は大きな文字に統一
  - 言葉は名詞のみ使用
  - 同じ言葉を2回以上使用しない

## ✨ 主な機能

### 🎮 ゲーム機能
- **日次パズル**: 毎日新しいクロスワードパズル
- **動的パズル生成**: 日本語クロスワード基本ルールに従った自動生成
- **難易度選択**: 初級・中級・上級
- **リアルタイム進捗**: 入力済みマスの表示
- **タイマー機能**: 経過時間の記録
- **ヒントシステム**: 3回まで使用可能
- **リセット**: 入力内容のみをクリア
- **初期化**: ゲーム状態・設定・ローカルストレージを完全初期化
- **日本語入力対応**: IME変換、かな表記統一、濁点・拗音処理
- **制約チェック**: 黒マス連続、外枠四隅、回転対称性の自動検証
- **🆕 改良されたパズル生成**: タテとヨコのカギがバランスよく生成される最適化アルゴリズム

### 🎨 UI/UX機能
- **レスポンシブデザイン**: デスクトップ・タブレット・スマートフォン対応
- **ダークモード**: 目に優しいダークテーマ
- **多言語対応**: 日本語・英語切り替え
- **フォントサイズ調整**: 5段階のサイズ変更
- **アクセシビリティ**: WCAG 2.1 AA準拠

### 📱 PWA機能
- **オフライン対応**: Service Workerによるキャッシュ
- **ホーム画面追加**: ネイティブアプリのような体験
- **プッシュ通知**: 新しいパズルのお知らせ
- **バックグラウンド同期**: オフライン時のデータ同期

### 💾 データ管理
- **ローカルストレージ**: ゲーム状態の自動保存
- **設定保存**: 言語・テーマ・フォントサイズ
- **進捗管理**: 入力済みデータの復元

## 🚀 技術スタック

### フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: Tailwind CSS + カスタムスタイル
- **JavaScript (ES6+)**: モダンなJavaScript機能
- **PWA**: Service Worker, Manifest, オフライン対応

### ライブラリ・フレームワーク
- **Tailwind CSS**: ユーティリティファーストCSS
- **Font Awesome**: アイコンライブラリ
- **Google Fonts**: Noto Sans JP, Inter

### 開発ツール
- **ESLint**: コード品質管理
- **Prettier**: コードフォーマット
- **Jest**: テストフレームワーク

## 📁 プロジェクト構造

```
crospuzz-daily/
├── index.html              # メインHTMLファイル
├── assets/
│   ├── css/
│   │   └── styles.css      # カスタムスタイル
│   ├── js/
│   │   └── app.js          # メインJavaScript
│   └── images/             # 画像ファイル
├── static/
│   └── puzzles/
│       └── daily-puzzle.json # パズルデータ
├── tests/
│   └── test-app.js         # テストファイル
├── docs/                   # ドキュメント
├── sw.js                   # Service Worker
├── README.md               # このファイル
├── SPEC.md                 # 仕様書
└── LICENSE                 # ライセンス
```

## 🛠️ セットアップ

### 前提条件
- Node.js 16.0以上
- npm または yarn

### インストール

1. リポジトリをクローン
```bash
git clone https://github.com/appadaycreator/crospuzz-daily.git
cd crospuzz-daily
```

2. 依存関係をインストール（必要な場合）
```bash
npm install
```

3. ローカルサーバーを起動
```bash
# Python 3の場合
python3 -m http.server 8004

# Node.jsの場合
npx serve -p 8004
```

4. ブラウザでアクセス
```
http://localhost:8004
```

## 🧪 テスト

### テストの実行
```bash
# ブラウザでテストを実行
open tests/test-app.html
```

### テストカバレッジ
- ゲーム初期化
- パズルデータ構造
- 翻訳機能
- 設定管理
- 進捗計算
- タイマー機能
- ヒントシステム
- 言語切り替え
- ダークモード切り替え
- フォントサイズ機能
- モバイルメニュー
- ゲーム状態管理

## 📱 PWA機能

### インストール方法
1. ブラウザでアプリにアクセス
2. アドレスバーのインストールアイコンをクリック
3. 「インストール」を選択

### オフライン機能
- Service Workerによるキャッシュ
- オフライン時のゲーム継続
- オンライン復帰時の同期

## ♿ アクセシビリティ

### 対応機能
- **キーボードナビゲーション**: 全機能をキーボードで操作可能
- **スクリーンリーダー対応**: ARIA属性の適切な使用
- **高コントラストモード**: システム設定に応じた表示
- **フォントサイズ調整**: 5段階のサイズ変更
- **色覚異常対応**: 色だけでなく形でも情報を伝達

### WCAG 2.1 AA準拠
- 適切なコントラスト比
- フォーカス表示の改善
- 代替テキストの提供
- キーボード操作の完全対応

## 🌐 多言語対応

### 対応言語
- **日本語**: メイン言語
- **英語**: 国際化対応

### 翻訳キー
- ナビゲーション
- ゲーム要素
- メッセージ
- 設定項目

## 📊 パフォーマンス

### 最適化
- **画像最適化**: WebP形式の使用
- **CSS/JS圧縮**: ファイルサイズの最小化
- **キャッシュ戦略**: 効率的なキャッシュ設定
- **遅延読み込み**: 必要に応じたリソース読み込み

### 測定指標
- **First Contentful Paint (FCP)**: < 1.5秒
- **Largest Contentful Paint (LCP)**: < 2.5秒
- **Cumulative Layout Shift (CLS)**: < 0.1
- **First Input Delay (FID)**: < 100ms

## 🔧 開発

### 開発環境のセットアップ
```bash
# 開発用サーバー起動
npm run dev

# テスト実行
npm test

# ビルド
npm run build
```

### コード規約
- **ESLint**: JavaScriptコード品質
- **Prettier**: コードフォーマット
- **Conventional Commits**: コミットメッセージ規約

### ブランチ戦略
- `main`: 本番環境
- `develop`: 開発環境
- `feature/*`: 機能開発
- `hotfix/*`: 緊急修正

## ⚠️ 既知の問題と対処法

### Web版で上級問題が選択できない場合
Service Workerのキャッシュにより古いデータが表示される場合があります。

**対処法：**
1. **Chrome/Edge**: F12 → Application → Storage → Clear site data
2. **Firefox**: F12 → Storage → Clear All  
3. **Safari**: 開発メニュー → Webサイトデータを消去
4. ブラウザを完全に再起動
5. Ctrl+F5（Mac: Cmd+Shift+R）でハード再読み込み

## 🔄 更新履歴

### v1.0.6 (2024/07/25) - 緊急修正
- **🐛 バグ修正**: GitHub PagesでのJSONファイル読み込みパス問題を修正
- **⚡ Service Worker改善**: puzzles.jsonは常に最新版を取得するように変更
- **🔧 エラーハンドリング**: 詳細なエラーメッセージとデバッグ情報を追加

### v1.0.5 (2024/07/24) - 難易度別選択機能実装
- **🎮 直感的UI**: 3つの難易度ボタンでワンクリック選択が可能
- **🎨 視覚的フィードバック**: 選択状態の明確な表示とホバーエフェクト
- **💾 状態保存**: 選択した難易度を自動保存・次回起動時に復元
- **🏷️ 動的バッジ**: アイコン付き難易度表示の自動更新機能
- **📋 フィルタ機能**: 選択した難易度のパズルのみを表示
- **🔄 シームレス切り替え**: 難易度変更時の自動パズル切り替え

### v1.0.4 (2024/07/24) - 難易度別問題大幅拡充
- **🎯 問題数拡充**: 各難易度に5問ずつ、合計15問の豊富なパズルを追加
- **🟢 初級パズル**: 動物、果物、乗り物、色、身の回りのもの（5テーマ）
- **🟡 中級パズル**: 食べ物、スポーツ、都道府県、四季、職業（5テーマ）
- **🔴 上級パズル**: 科学技術、医学、地理、芸術、歴史（5テーマ）
- **🎮 パズル選択機能**: ドロップダウンで自由に選択可能
- **🏷️ 難易度表示**: 視覚的に分かりやすい難易度バッジ

### v1.0.3 (2024/07/24) - 番号付けロジック修正
- **🔢 番号付けロジック改善**: 実際に配置された単語のみに番号を付与するように修正
- **📋 カギと番号の完全一致**: グリッド番号とカギ番号を100%整合させ、不一致問題を根本解決
- **📊 デバッグ機能追加**: 番号付けプロセスの詳細ログを追加
- **✅ 品質保証**: パズル番号とカギ番号の不一致問題を完全に解決

### v1.0.2 (2024/07/24) - 緊急パッチ
- **🚨 緊急修正**: パズルが表示されない致命的な無限ループ問題を解決
- **⚡ パフォーマンス改善**: 単語数を8個に制限し、処理速度を大幅向上
- **⏱️ タイムアウト機能**: 5秒でパズル生成を制限し、フリーズを防止
- **🛡️ フォールバック機能**: 安定したパズル生成を保証するフェイルセーフ機能を追加
- **📊 デバッグ強化**: 詳細なログでトラブルシューティングを改善

### v1.0.1 (2024/07/24)
- **🐛 バグ修正**: タテの鍵が表示されない問題を解決
- **⚡ パフォーマンス改善**: パズル生成アルゴリズムの最適化
- **🔧 改良**: 単語数制限（最大15個）によるメモリ使用量削減
- **📊 改善**: デバッグログの充実とエラーハンドリング強化
- **📁 追加**: .gitignoreファイルでリポジトリ管理を改善

### v1.0.0 (2024/07/01)
- **🎉 初回リリース**: 基本的なクロスワードパズル機能
- **📱 PWA対応**: オフライン機能とホーム画面追加
- **🌍 多言語対応**: 日本語・英語切り替え
- **♿ アクセシビリティ**: WCAG 2.1 AA準拠

## 📈 分析・監視

### Google Analytics
- ページビュー追跡
- イベント追跡
- ユーザー行動分析

### エラー監視
- コンソールエラーの記録
- パフォーマンス監視
- ユーザー体験の追跡

## 🤝 コントリビューション

### 貢献方法
1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

### 開発ガイドライン
- コードレビューの必須化
- テストの追加
- ドキュメントの更新
- アクセシビリティの考慮

## 📄 ライセンス

このプロジェクトは [MIT License](LICENSE) の下で公開されています。

## 🙏 謝辞

- **Tailwind CSS**: 美しいUIフレームワーク
- **Font Awesome**: 豊富なアイコンライブラリ
- **Google Fonts**: 高品質なフォント
- **PWA**: モダンなWebアプリケーション技術

## 📞 サポート

### お問い合わせ
- **GitHub Issues**: バグ報告・機能要望
- **Email**: support@crospuzz.com
- **Twitter**: [@CrosPuzz](https://twitter.com/CrosPuzz)

### よくある質問
- [FAQ](docs/FAQ.md)
- [トラブルシューティング](docs/TROUBLESHOOTING.md)
- [更新履歴](docs/CHANGELOG.md)

---

**CrosPuzz** - 毎日の脳トレクロスワードパズル 🧩

*Made with ❤️ by AppAdayCreator*